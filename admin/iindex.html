<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>后台登录</title>
<style>
body { font-family: system-ui; background:#f5f5f5; padding:30px }
.box { max-width:400px; margin:auto; background:#fff; padding:20px; border-radius:8px }
input, button { width:100%; padding:10px; margin-top:10px }
</style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>后台登录</h2>
  <input id="pwd" type="password" placeholder="后台密码">
  <button onclick="login()">登录</button>
  <p id="err" style="color:red"></p>
</div>

<div class="box" id="panel" style="display:none">
  <h2>留言列表</h2>
  <ul id="list"></ul>
</div>

<script>
const API = "https://api.dttg.de5.net"

async function login() {
  const password = document.getElementById("pwd").value
  const res = await fetch(API + "/api/admin/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ password })
  })
  const data = await res.json()
  if (!data.token) {
    document.getElementById("err").innerText = data.error
    return
  }
  localStorage.token = data.token
  loadMessages()
}

async function loadMessages() {
  document.getElementById("loginBox").style.display = "none"
  document.getElementById("panel").style.display = "block"

  const res = await fetch(API + "/api/admin/messages", {
    headers:{ "Authorization":"Bearer " + localStorage.token }
  })
  const data = await res.json()

  const ul = document.getElementById("list")
  ul.innerHTML = ""
  data.forEach(m=>{
    const li = document.createElement("li")
    li.innerText = `${m.time} | ${m.name}：${m.content}`
    ul.appendChild(li)
  })
}
</script>

</body>
</html>
