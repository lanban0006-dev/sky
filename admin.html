<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>后台模块管理</title>
<style>
body { background:#111;color:#fff;font-family:sans-serif }
.box { width:360px;margin:80px auto;padding:20px;background:#1e1e1e;border-radius:8px }
button { width:100%;padding:10px;margin-top:10px }
label { display:flex;justify-content:space-between;margin:10px 0 }
</style>
</head>
<body>

<div class="box" id="login">
  <h3>TG 验证登录</h3>
  <button onclick="sendCode()">发送验证码到 TG</button>
  <input id="code" placeholder="输入 TG 验证码">
  <button onclick="verify()">登录</button>
</div>

<div class="box" id="panel" style="display:none">
  <h3>模块管理</h3>

  <label>留言模块 <input type="checkbox" id="message"></label>
  <label>TG 通知 <input type="checkbox" id="telegram"></label>
  <label>首页展示 <input type="checkbox" id="home"></label>

  <button onclick="save()">保存</button>
</div>

<script>
const API = "https://api.dttg.de5.net"

function sendCode() {
  fetch(API + "/api/admin/login", { method:"POST" })
    .then(()=>alert("验证码已发送到 TG"))
}

function verify() {
  fetch(API + "/api/admin/verify", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ code: code.value })
  }).then(r=>{
    if(!r.ok) return alert("验证码错误")
    login.style.display="none"
    panel.style.display="block"
    load()
  })
}

function load() {
  fetch(API + "/api/modules")
    .then(r=>r.json())
    .then(m=>{
      message.checked = m.message
      telegram.checked = m.telegram
      home.checked = m.home
    })
}

function save() {
  ["message","telegram","home"].forEach(k=>{
    fetch(API + "/api/admin/module",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ key:k, value:document.getElementById(k).checked })
    })
  })
  alert("已保存")
}
</script>

</body>
</html>
