<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>æ¨¡å—ç®¡ç†åå°</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
  margin: 0;
  background: #0f1115;
  color: #fff;
  font-family: system-ui;
}
.wrap {
  max-width: 480px;
  margin: 40px auto;
  padding: 20px;
}
h1 {
  font-size: 18px;
  margin-bottom: 20px;
}
.card {
  background: #181b20;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
button {
  padding: 6px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #f6c343;
  font-weight: bold;
}
.off {
  background: #444;
  color: #aaa;
}
.msg {
  text-align: center;
  font-size: 13px;
  color: #aaa;
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="wrap">
  <h1>ğŸ§© æ¨¡å—ç®¡ç†åå°</h1>

  <div class="card">
    <span>ç•™è¨€æ¨¡å—</span>
    <button id="msgBtn" onclick="toggle('message')">åŠ è½½ä¸­</button>
  </div>

  <div class="card">
    <span>é¦–é¡µå±•ç¤º</span>
    <button id="homeBtn" onclick="toggle('home')">åŠ è½½ä¸­</button>
  </div>

  <div class="card">
    <span>TG é€šçŸ¥</span>
    <button id="tgBtn" onclick="toggle('telegram')">åŠ è½½ä¸­</button>
  </div>

  <div class="msg" id="msg"></div>
</div>

<script>
const API = "https://api.dttg.de5.net";

function show(t){ document.getElementById("msg").innerText = t }

async function authCheck() {
  const r = await fetch(API + "/api/admin/me", { credentials: "include" });
  if (!r.ok) location.href = "/login.html";
}

async function load() {
  const r = await fetch(API + "/api/admin/modules");
  const d = await r.json();
  setBtn("message", d.message);
  setBtn("home", d.home);
  setBtn("telegram", d.telegram);
}

function setBtn(k, v) {
  const m = { message: "msgBtn", home: "homeBtn", telegram: "tgBtn" };
  const b = document.getElementById(m[k]);
  b.innerText = v ? "å·²å¼€å¯" : "å·²å…³é—­";
  b.className = v ? "" : "off";
}

async function toggle(k) {
  const r = await fetch(API + "/api/admin/module-toggle", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ key: k })
  });
  const d = await r.json();
  show("å·²æ›´æ–°");
  setBtn(k, d.enabled);
}

authCheck();
load();
</script>

</body>
</html>
