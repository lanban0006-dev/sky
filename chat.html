<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ä¸´æ—¶å¯¹è¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  background: #0f0f0f;
  color: #fff;
  font-family: system-ui;
}
.container {
  max-width: 720px;
  margin: auto;
  padding: 20px;
}
h1 {
  font-size: 20px;
  margin-bottom: 10px;
}
.chat {
  background: #181818;
  border-radius: 10px;
  padding: 15px;
  min-height: 300px;
  margin-bottom: 10px;
}
.msg {
  margin-bottom: 10px;
}
.user {
  color: #f5c542;
}
.admin {
  color: #4fc3f7;
}
textarea, button {
  width: 100%;
  border-radius: 8px;
  border: none;
  padding: 10px;
  margin-top: 8px;
}
button {
  background: #f5c542;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ’¬ ä¸´æ—¶å¯¹è¯ï¼ˆå…³é—­é¡µé¢è‡ªåŠ¨å¤±æ•ˆï¼‰</h1>

  <div id="chat" class="chat"></div>

  <textarea id="content" placeholder="è¾“å…¥ä½ è¦å‘é€çš„æ¶ˆæ¯"></textarea>
  <button onclick="send()">å‘é€</button>
</div>

<script>
const API = "https://api.dttg.de5.net"
const chatId = new URLSearchParams(location.search).get("chatId")
const chatBox = document.getElementById("chat")

if (!chatId) {
  alert("ä¼šè¯å·²å¤±æ•ˆ")
}

// æ‹‰å–èŠå¤©è®°å½•
async function pull() {
  const res = await fetch(API + "/api/chat/pull?chatId=" + chatId)
  const list = await res.json()

  chatBox.innerHTML = ""
  list.forEach(m => {
    const div = document.createElement("div")
    div.className = "msg " + m.from
    div.innerHTML = `<b>${m.from === "user" ? "ä½ " : "æˆ‘"}ï¼š</b>${m.content}`
    chatBox.appendChild(div)
  })

  chatBox.scrollTop = chatBox.scrollHeight
}

// å‘é€æ¶ˆæ¯
async function send() {
  const content = document.getElementById("content").value.trim()
  if (!content) return

  await fetch(API + "/api/chat/send", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chatId, content })
  })

  document.getElementById("content").value = ""
  pull()
}

// â­ è½®è¯¢ï¼ˆ3 ç§’ä¸€æ¬¡ï¼‰
pull()
setInterval(pull, 3000)
</script>
</body>
</html>
